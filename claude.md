# 五险一金计算器 Web 应用 - 项目计划

## 项目概述

从零开始构建一个迷你 "五险一金" 计算器 Web 应用，核心功能是根据预设的员工工资原始数据和城市社保政策标准，自动计算公司应缴纳的社保金额，并将结果存储和展示。

## 技术栈

- **前端框架**: Next.js
- **UI 样式**: Tailwind CSS
- **后端/数据库**: Supabase

## 数据库设计（Supabase）

### 1. cities（城市社保标准表）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| id | int | 主键，唯一编号 | 1, 2, 3... |
| city_name | text | 城市名称 | "佛山" |
| year | text | 适用年度 | "2024" |
| base_min | int | 社保缴费基数下限 | 3958 |
| base_max | int | 社保缴费基数上限 | 21000 |
| rate | float | 综合社保缴纳比例 | 0.15 |

### 2. salaries（员工工资表）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| id | int | 主键，唯一编号 | 1, 2, 3... |
| employee_id | text | 员工工号 | "0001" |
| employee_name | text | 员工姓名 | "张三" |
| month | text | 工资发放月份 | "202401" |
| salary_amount | int | 该月实际发放工资金额 | 5000 |

### 3. results（计算结果表）

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| id | int | 主键，唯一编号 | 1, 2, 3... |
| employee_name | text | 员工姓名 | "张三" |
| avg_salary | float | 员工年度月平均工资 | 5500.00 |
| contribution_base | float | 最终社保缴费基数 | 5500.00 |
| company_fee | float | 公司应缴纳的社保金额 | 825.00 |

## 核心业务逻辑

### 计算函数执行步骤

1. **读取工资数据**：从 `salaries` 表读取所有员工工资数据
2. **计算平均工资**：按 `employee_name` 分组，计算每位员工的 "年度月平均工资"
3. **获取城市标准**：从 `cities` 表获取 "佛山" 对应的 `year`、`base_min`、`base_max` 和 `rate`
4. **确定缴费基数**：对每位员工，将其 "年度月平均工资" 与佛山的基数上下限比较
   - 若 平均工资 < base_min → 缴费基数 = base_min
   - 若 平均工资 > base_max → 缴费基数 = base_max
   - 否则 → 缴费基数 = 平均工资
5. **计算公司缴费**：根据最终缴费基数和 rate，计算公司应缴纳金额（缴费基数 × 比例）
6. **存储结果**：将每位员工的计算结果存入 `results` 表

## 前端页面规划

### 1. `/`（主页 - 导航中枢）

**布局**: 两个并排或垂直排列的功能卡片

- **卡片1**: "数据上传" → 点击跳转到 `/upload`
- **卡片2**: "结果查询" → 点击跳转到 `/results`

### 2. `/upload`（数据上传与操作页）

**功能**:
- **上传数据按钮**: 从本地选择 Excel 文件，批量插入数据到 `cities` 和 `salaries` 表
- **执行计算按钮**: 触发核心业务逻辑，将结果存入 `results` 表

### 3. `/results`（结果查询与展示页）

**功能**:
- 页面加载时自动从 `results` 表获取所有计算结果
- 使用 Tailwind CSS 渲染结构清晰、样式简洁的表格展示数据

**表格表头**:
- 员工姓名
- 年度月平均工资
- 社保缴费基数
- 公司应缴金额

## 项目文件结构规划

```
shebao/
├── claude.md                 # 项目计划文件（本文件）
├── package.json              # 项目依赖配置
├── next.config.js            # Next.js 配置
├── tailwind.config.js        # Tailwind CSS 配置
├── tsconfig.json             # TypeScript 配置
├── .env.local                # 环境变量（Supabase 凭证）
├── app/
│   ├── layout.tsx            # 根布局
│   ├── page.tsx              # 主页（导航中枢）
│   ├── upload/
│   │   └── page.tsx          # 数据上传页
│   └── results/
│       └── page.tsx          # 结果展示页
├── lib/
│   └── supabase.ts           # Supabase 客户端配置
├── utils/
│   ├── calculator.ts         # 核心计算逻辑
│   └── excelParser.ts        # Excel 文件解析
└── types/
    └── index.ts              # TypeScript 类型定义
```

## 开发步骤

### 阶段一：项目初始化
1. 创建 Next.js 项目（TypeScript + Tailwind CSS）
2. 配置 Supabase 客户端
3. 在 Supabase 控制台创建数据表
4. 定义 TypeScript 类型

### 阶段二：核心业务逻辑
1. 实现 Supabase 数据 CRUD 操作函数
2. 实现核心计算逻辑函数
3. 实现 Excel 文件解析功能

### 阶段三：前端页面开发
1. 开发主页（导航卡片）
2. 开发数据上传页（Excel 上传 + 计算触发）
3. 开发结果展示页（数据表格）

### 阶段四：测试与优化
1. 端到端功能测试
2. UI/UX 优化
3. 错误处理完善

---

## 需要确认的问题

在开始开发之前，请确认以下问题：

### 1. Excel 文件格式
- 上传的 Excel 文件是否有固定格式？
- cities 和 salaries 数据是放在同一个 Excel 的不同 sheet，还是分别上传两个文件？
- 是否需要提供 Excel 模板下载功能？

### 2. 计算逻辑细节
- "年度月平均工资" 的计算范围是：自然年（1-12月）还是从第一条数据到当前月份？
- 如果某个员工的工资数据不足12个月，如何处理？
- 计算结果存储时，是否需要保留历史结果？每次计算是覆盖还是追加？

### 3. 用户认证与权限
- 是否需要用户登录系统？
- 上传和计算操作是否需要权限控制？

### 4. 城市选择
- 目前固定为 "佛山"，是否未来需要支持多城市？
- 如果支持多城市，上传页是否需要城市选择器？

### 5. 结果展示功能
- 结果展示页是否需要搜索/筛选功能？
- 是否需要导出结果为 Excel 的功能？
- 是否需要删除或清空结果的功能？

### 6. UI 设计偏好
- 主页卡片是否需要图标或图片？
- 整体颜色风格是否有偏好（如蓝色系、绿色系等）？
- 表格是否需要分页（当数据量大时）？

请确认以上问题后，我再开始具体的代码开发工作。
